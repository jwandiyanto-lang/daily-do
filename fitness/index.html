<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness - Daily Do</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #0E121A;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            padding-bottom: 100px;
            transition: background 0.3s, color 0.3s;
        }

        body.light-theme {
            background: #F5F5F7;
            color: #1a1a1a;
        }

        body.light-theme .back-link { color: #666; }
        body.light-theme .subtitle { color: #666; }
        body.light-theme .tab-btn { background: rgba(0,0,0,0.05); color: #666; }
        body.light-theme .tab-btn.active { background: #F7C846; color: #0E121A; }
        body.light-theme .trainer-card { background: #fff; border-color: rgba(0,0,0,0.1); }
        body.light-theme .workout-detail { background: #fff; }
        body.light-theme .exercise-card { background: rgba(0,0,0,0.03); }
        body.light-theme .exercise-name { color: #1a1a1a; }
        body.light-theme .exercise-meta { color: #666; }
        body.light-theme .pref-card { background: #fff; border-color: rgba(0,0,0,0.1); }
        body.light-theme .pref-option { background: rgba(0,0,0,0.03); border-color: rgba(0,0,0,0.1); color: #333; }
        body.light-theme .history-item { background: #fff; border: 1px solid rgba(0,0,0,0.08); }
        body.light-theme .history-date { color: #666; }
        body.light-theme .modal-content { background: #fff; }
        body.light-theme .rest-text { color: #666; }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        h1 { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .subtitle { color: #888; margin-bottom: 24px; }

        .tabs { display: flex; gap: 8px; margin-bottom: 24px; }
        .tab-btn {
            flex: 1; padding: 12px;
            background: rgba(255,255,255,0.05);
            border: none; border-radius: 10px;
            color: #888; font-size: 0.85rem; font-weight: 500;
            cursor: pointer; transition: all 0.2s; font-family: inherit;
        }
        .tab-btn.active { background: #F7C846; color: #0E121A; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .trainer-card {
            background: linear-gradient(135deg, #1a1f2e 0%, #0E121A 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 24px; margin-bottom: 20px;
        }
        .trainer-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .trainer-avatar {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, #F7C846 0%, #ff9500 100%);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 1.5rem;
        }
        .trainer-info h3 { font-size: 1rem; font-weight: 600; }
        .trainer-info p { font-size: 0.8rem; color: #888; }
        .trainer-message { font-size: 0.95rem; line-height: 1.5; margin-bottom: 20px; }
        .generate-btn {
            width: 100%; padding: 16px;
            background: #F7C846; border: none; border-radius: 12px;
            color: #0E121A; font-size: 1rem; font-weight: 600;
            cursor: pointer; font-family: inherit;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .generate-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .pref-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 20px; margin-bottom: 20px;
        }
        .pref-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 12px; color: #888; }
        .pref-options { display: flex; flex-wrap: wrap; gap: 8px; }
        .pref-option {
            padding: 10px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; font-size: 0.85rem; color: #ccc;
            cursor: pointer; transition: all 0.2s;
        }
        .pref-option.selected {
            background: rgba(247, 200, 70, 0.2);
            border-color: #F7C846; color: #F7C846;
        }

        .workout-detail { background: rgba(255,255,255,0.03); border-radius: 20px; overflow: hidden; }
        .workout-header {
            background: linear-gradient(135deg, #F7C846 0%, #ff9500 100%);
            padding: 24px; color: #0E121A;
        }
        .workout-type { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 4px; }
        .workout-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; }
        .workout-meta { display: flex; gap: 16px; font-size: 0.85rem; }
        .workout-body { padding: 20px; }
        .section-label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 12px; margin-top: 20px; }
        .section-label:first-child { margin-top: 0; }

        .exercise-card { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; margin-bottom: 10px; }
        .exercise-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .exercise-number {
            width: 28px; height: 28px;
            background: rgba(247, 200, 70, 0.2); color: #F7C846;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 0.8rem; font-weight: 600;
            margin-right: 12px; flex-shrink: 0;
        }
        .exercise-info { flex: 1; }
        .exercise-name { font-weight: 600; font-size: 1rem; margin-bottom: 4px; }
        .exercise-meta { font-size: 0.8rem; color: #888; }
        .exercise-detail { font-size: 0.85rem; color: #aaa; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }

        .workout-actions { display: flex; gap: 12px; padding: 20px; padding-top: 0; }
        .action-btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; font-family: inherit; }
        .action-btn.primary { background: #8AE98D; color: #0E121A; }
        .action-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }

        .history-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .history-date { font-size: 0.8rem; color: #888; margin-bottom: 8px; }
        .history-title { font-weight: 600; margin-bottom: 8px; }
        .history-exercises { font-size: 0.85rem; color: #aaa; }
        .history-stats { display: flex; gap: 16px; margin-top: 10px; font-size: 0.8rem; }
        .history-stat { color: #8AE98D; }

        .empty-state { text-align: center; padding: 40px; color: #666; }
        .empty-icon { font-size: 3rem; margin-bottom: 12px; }

        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; padding: 20px; }
        .modal.show { display: block; }
        .modal-content { background: #1a1f2e; border-radius: 20px; max-width: 500px; margin: 0 auto; overflow: hidden; }

        .active-exercise { padding: 30px; text-align: center; }
        .active-exercise-number { font-size: 0.85rem; color: #888; margin-bottom: 8px; }
        .active-exercise-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; }
        .active-exercise-detail { font-size: 1.1rem; color: #F7C846; margin-bottom: 8px; }
        .active-exercise-tip { font-size: 0.9rem; color: #888; margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; }
        .timer-display { font-size: 4rem; font-weight: 700; color: #F7C846; margin: 30px 0; }

        .rest-overlay { background: linear-gradient(135deg, #1a3a1a 0%, #0E121A 100%); padding: 40px; text-align: center; }
        .rest-text { font-size: 1.2rem; color: #8AE98D; margin-bottom: 10px; }
        .next-up { font-size: 0.9rem; color: #888; margin-top: 20px; }

        .modal-actions { display: flex; gap: 12px; padding: 20px; }
        .modal-btn { flex: 1; padding: 16px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; font-family: inherit; }
        .modal-btn.primary { background: #8AE98D; color: #0E121A; }
        .modal-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .modal-btn.skip { background: rgba(255,255,255,0.05); color: #888; }

        .progress-bar { height: 4px; background: rgba(255,255,255,0.1); margin: 20px; border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: #F7C846; transition: width 0.3s; }

        .loading { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .loading-dot { width: 8px; height: 8px; background: #F7C846; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link"><span>‚Üê</span> Back to Daily Do</a>
    <h1>Fitness</h1>
    <p class="subtitle">Your AI Personal Trainer</p>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('train')">Train</button>
        <button class="tab-btn" onclick="switchTab('history')">History</button>
    </div>

    <div id="train-tab" class="tab-content active">
        <div class="trainer-card">
            <div class="trainer-header">
                <div class="trainer-avatar">üèãÔ∏è</div>
                <div class="trainer-info">
                    <h3>Coach AI</h3>
                    <p>Your Personal Trainer</p>
                </div>
            </div>
            <div class="trainer-message" id="trainer-message">
                Ready to crush your workout? Tell me what you want to focus on and I'll create a personalized routine for you!
            </div>
            <button class="generate-btn" id="generate-btn" onclick="generateWorkout()">
                <span>‚ö°</span> Generate My Workout
            </button>
        </div>

        <div class="pref-card">
            <div class="pref-title">Focus Area</div>
            <div class="pref-options" id="focus-options">
                <div class="pref-option selected" data-value="full">Full Body</div>
                <div class="pref-option" data-value="upper">Upper Body</div>
                <div class="pref-option" data-value="lower">Lower Body</div>
                <div class="pref-option" data-value="core">Core</div>
                <div class="pref-option" data-value="cardio">Cardio</div>
            </div>
        </div>

        <div class="pref-card">
            <div class="pref-title">Duration</div>
            <div class="pref-options" id="duration-options">
                <div class="pref-option" data-value="15">15 min</div>
                <div class="pref-option selected" data-value="25">25 min</div>
                <div class="pref-option" data-value="35">35 min</div>
            </div>
        </div>

        <div class="pref-card">
            <div class="pref-title">Intensity</div>
            <div class="pref-options" id="intensity-options">
                <div class="pref-option" data-value="easy">Easy</div>
                <div class="pref-option selected" data-value="moderate">Moderate</div>
                <div class="pref-option" data-value="hard">Intense</div>
            </div>
        </div>

        <div id="workout-container" style="display: none;"></div>
    </div>

    <div id="history-tab" class="tab-content">
        <div id="history-list"></div>
    </div>

    <div id="workout-modal" class="modal">
        <div class="modal-content" id="modal-body"></div>
    </div>

    <script src="../scripts/memory.js"></script>
    <script>
        const exercises = {
            upper: {
                warmup: [
                    { name: 'Arm Circles', duration: '30 sec each direction', tip: 'Start small, gradually increase the circle size' },
                    { name: 'Shoulder Rolls', duration: '20 reps', tip: 'Roll forward then backward' },
                    { name: 'Chest Opener Stretch', duration: '30 sec', tip: 'Clasp hands behind back, lift chest' }
                ],
                main: [
                    { name: 'Push-Ups', sets: 3, reps: '10-15', rest: 45, tip: 'Keep your core tight, lower until chest nearly touches floor' },
                    { name: 'Diamond Push-Ups', sets: 3, reps: '8-12', rest: 45, tip: 'Hands together forming a diamond, targets triceps' },
                    { name: 'Pike Push-Ups', sets: 3, reps: '8-10', rest: 60, tip: 'Hips high, head toward floor - great for shoulders' },
                    { name: 'Tricep Dips', sets: 3, reps: '12-15', rest: 45, tip: 'Use a chair or bench, keep elbows close' },
                    { name: 'Plank Shoulder Taps', sets: 3, reps: '20 taps', rest: 45, tip: 'Keep hips stable, don\'t rotate' },
                    { name: 'Superman Hold', sets: 3, reps: '20 sec', rest: 30, tip: 'Lift arms and legs, squeeze back muscles' },
                    { name: 'Wide Push-Ups', sets: 3, reps: '10-12', rest: 45, tip: 'Hands wider than shoulders, targets chest' },
                    { name: 'Incline Push-Ups', sets: 3, reps: '12-15', rest: 45, tip: 'Hands on elevated surface, easier variation' }
                ],
                cooldown: [
                    { name: 'Chest Doorway Stretch', duration: '30 sec each side', tip: 'Arm on doorframe, lean forward gently' },
                    { name: 'Tricep Stretch', duration: '30 sec each arm', tip: 'Elbow up, hand behind head, pull gently' },
                    { name: 'Child\'s Pose', duration: '45 sec', tip: 'Arms extended, breathe deeply' }
                ]
            },
            lower: {
                warmup: [
                    { name: 'Leg Swings', duration: '15 each leg', tip: 'Hold wall for balance, swing front to back' },
                    { name: 'Hip Circles', duration: '10 each direction', tip: 'Hands on hips, big smooth circles' },
                    { name: 'Bodyweight Squats', duration: '15 reps slow', tip: 'Warm up the movement pattern' }
                ],
                main: [
                    { name: 'Goblet Squats', sets: 3, reps: '12-15', rest: 60, tip: 'Weight at chest, sit back and down, knees track over toes' },
                    { name: 'Reverse Lunges', sets: 3, reps: '10 each leg', rest: 60, tip: 'Step back, front knee at 90¬∞, drive through front heel' },
                    { name: 'Romanian Deadlifts', sets: 3, reps: '12', rest: 60, tip: 'Slight knee bend, hinge at hips, feel the hamstring stretch' },
                    { name: 'Jump Squats', sets: 3, reps: '10', rest: 60, tip: 'Explode up, land softly with bent knees' },
                    { name: 'Glute Bridges', sets: 3, reps: '15', rest: 45, tip: 'Squeeze glutes at top, don\'t hyperextend back' },
                    { name: 'Bulgarian Split Squats', sets: 3, reps: '10 each', rest: 60, tip: 'Back foot elevated, stay upright' },
                    { name: 'Calf Raises', sets: 3, reps: '20', rest: 30, tip: 'Full range of motion, pause at top' },
                    { name: 'Wall Sit', sets: 3, reps: '30 sec', rest: 45, tip: 'Thighs parallel to floor, back flat against wall' }
                ],
                cooldown: [
                    { name: 'Quad Stretch', duration: '30 sec each leg', tip: 'Stand on one leg, pull heel to glute' },
                    { name: 'Hamstring Stretch', duration: '30 sec each leg', tip: 'Seated or standing, reach for toes' },
                    { name: 'Pigeon Pose', duration: '45 sec each side', tip: 'Great for hip flexors and glutes' }
                ]
            },
            core: {
                warmup: [
                    { name: 'Cat-Cow Stretch', duration: '10 reps', tip: 'Alternate between arching and rounding spine' },
                    { name: 'Dead Bug Hold', duration: '30 sec', tip: 'Back flat on floor, engage core' },
                    { name: 'Bird Dogs', duration: '10 each side', tip: 'Opposite arm and leg, keep hips level' }
                ],
                main: [
                    { name: 'Plank', sets: 3, reps: '30-45 sec', rest: 30, tip: 'Straight line from head to heels, don\'t let hips sag' },
                    { name: 'Bicycle Crunches', sets: 3, reps: '20 each side', rest: 30, tip: 'Elbow to opposite knee, fully extend other leg' },
                    { name: 'Mountain Climbers', sets: 3, reps: '30 sec', rest: 30, tip: 'Drive knees toward chest quickly, keep core tight' },
                    { name: 'Russian Twists', sets: 3, reps: '20 total', rest: 30, tip: 'Lean back slightly, rotate fully side to side' },
                    { name: 'Leg Raises', sets: 3, reps: '12', rest: 45, tip: 'Keep lower back pressed to floor, control the descent' },
                    { name: 'Dead Bug', sets: 3, reps: '10 each side', rest: 30, tip: 'Lower opposite arm and leg, keep back flat' },
                    { name: 'Side Plank', sets: 3, reps: '25 sec each', rest: 30, tip: 'Stack feet or stagger, hips off ground' },
                    { name: 'Flutter Kicks', sets: 3, reps: '30 sec', rest: 30, tip: 'Small controlled kicks, lower back down' }
                ],
                cooldown: [
                    { name: 'Cobra Stretch', duration: '30 sec', tip: 'Press up gently, hips on floor' },
                    { name: 'Supine Twist', duration: '30 sec each side', tip: 'Knees to one side, opposite arm out' },
                    { name: 'Happy Baby', duration: '45 sec', tip: 'Grab feet, gently rock side to side' }
                ]
            },
            full: {
                warmup: [
                    { name: 'Jumping Jacks', duration: '30 sec', tip: 'Land softly, keep a rhythm' },
                    { name: 'High Knees', duration: '30 sec', tip: 'Drive knees up, pump arms' },
                    { name: 'Arm Circles + Leg Swings', duration: '30 sec', tip: 'Get blood flowing to all joints' }
                ],
                main: [
                    { name: 'Burpees', sets: 3, reps: '8-10', rest: 60, tip: 'Full extension jump, chest to floor on pushup' },
                    { name: 'Squat to Press', sets: 3, reps: '12', rest: 45, tip: 'Squat down, drive up and press overhead' },
                    { name: 'Push-Ups', sets: 3, reps: '12-15', rest: 45, tip: 'Full range of motion, core engaged' },
                    { name: 'Reverse Lunges', sets: 3, reps: '10 each', rest: 45, tip: 'Alternate legs, stay controlled' },
                    { name: 'Plank Rows', sets: 3, reps: '10 each side', rest: 45, tip: 'Pull elbow high, minimize hip rotation' },
                    { name: 'Jump Squats', sets: 3, reps: '12', rest: 45, tip: 'Explode up, soft landing' },
                    { name: 'Mountain Climbers', sets: 3, reps: '30 sec', rest: 30, tip: 'Fast pace, drive knees to chest' },
                    { name: 'Superman Pulls', sets: 3, reps: '12', rest: 30, tip: 'Arms extended, pull elbows back' }
                ],
                cooldown: [
                    { name: 'Standing Forward Fold', duration: '45 sec', tip: 'Let head hang, bend knees if needed' },
                    { name: 'World\'s Greatest Stretch', duration: '30 sec each', tip: 'Lunge, rotate, reach - hits everything' },
                    { name: 'Child\'s Pose', duration: '45 sec', tip: 'Breathe deeply, relax completely' }
                ]
            },
            cardio: {
                warmup: [
                    { name: 'March in Place', duration: '30 sec', tip: 'Lift knees high, swing arms' },
                    { name: 'Arm Swings', duration: '20 sec', tip: 'Loosen up shoulders' },
                    { name: 'Bodyweight Squats', duration: '10 reps', tip: 'Get legs warmed up' }
                ],
                main: [
                    { name: 'High Knees', sets: 4, reps: '30 sec', rest: 15, tip: 'Sprint pace, pump those arms!' },
                    { name: 'Burpees', sets: 4, reps: '30 sec', rest: 15, tip: 'Go as fast as you can with good form' },
                    { name: 'Jump Squats', sets: 4, reps: '30 sec', rest: 15, tip: 'Explosive jumps, soft landings' },
                    { name: 'Mountain Climbers', sets: 4, reps: '30 sec', rest: 15, tip: 'Drive those knees fast!' },
                    { name: 'Jumping Lunges', sets: 4, reps: '30 sec', rest: 15, tip: 'Switch legs in the air' },
                    { name: 'Skaters', sets: 4, reps: '30 sec', rest: 15, tip: 'Lateral bounds, stay low' },
                    { name: 'Tuck Jumps', sets: 3, reps: '30 sec', rest: 20, tip: 'Bring knees to chest at peak' },
                    { name: 'Fast Feet', sets: 4, reps: '30 sec', rest: 15, tip: 'Quick small steps, stay light' }
                ],
                cooldown: [
                    { name: 'Walk in Place', duration: '1 min', tip: 'Slow your heart rate gradually' },
                    { name: 'Deep Breathing', duration: '1 min', tip: '4 counts in, 4 counts out' },
                    { name: 'Full Body Stretch', duration: '2 min', tip: 'Hit all major muscle groups' }
                ]
            }
        };

        const trainerMessages = {
            full: "Full body day! We're hitting everything - get ready to feel accomplished üí™",
            upper: "Let's sculpt that upper body! Focus on form over speed today üéØ",
            lower: "Leg day is best day! Strong legs = strong foundation ü¶µ",
            core: "Core work incoming! A strong core improves everything else üî•",
            cardio: "Cardio blast! Keep moving, keep breathing, you've got this! üèÉ"
        };

        let currentWorkout = null;
        let currentExerciseIndex = 0;
        let timerInterval = null;
        let exerciseTime = 0;
        let selectedFocus = 'full';
        let selectedDuration = 25;
        let selectedIntensity = 'moderate';

        function init() {
            loadTheme();
            setupPreferenceListeners();
            renderHistory();
        }

        function loadTheme() {
            if (typeof Memory !== 'undefined') {
                const savedTheme = Memory.get('settings', 'theme');
                if (savedTheme === 'light') document.body.classList.add('light-theme');
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }

        function setupPreferenceListeners() {
            document.querySelectorAll('.pref-options').forEach(group => {
                group.addEventListener('click', (e) => {
                    if (e.target.classList.contains('pref-option')) {
                        group.querySelectorAll('.pref-option').forEach(opt => opt.classList.remove('selected'));
                        e.target.classList.add('selected');
                        const value = e.target.dataset.value;
                        if (group.id === 'focus-options') selectedFocus = value;
                        if (group.id === 'duration-options') selectedDuration = parseInt(value);
                        if (group.id === 'intensity-options') selectedIntensity = value;
                    }
                });
            });
        }

        function generateWorkout() {
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"><span class="loading-dot"></span><span class="loading-dot"></span><span class="loading-dot"></span></span> Creating your workout...';
            document.getElementById('trainer-message').textContent = trainerMessages[selectedFocus];

            setTimeout(() => {
                const workout = buildWorkout();
                currentWorkout = workout;
                renderWorkout(workout);
                btn.disabled = false;
                btn.innerHTML = '<span>üîÑ</span> Generate New Workout';
            }, 1500);
        }

        function buildWorkout() {
            const exercisePool = exercises[selectedFocus];
            const numExercises = selectedDuration === 15 ? 4 : selectedDuration === 25 ? 5 : 7;
            const setsMultiplier = selectedIntensity === 'easy' ? 0.7 : selectedIntensity === 'hard' ? 1.3 : 1;

            const shuffled = [...exercisePool.main].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, numExercises);
            const mainExercises = selected.map(ex => ({ ...ex, sets: Math.round(ex.sets * setsMultiplier) }));

            return {
                type: selectedFocus, duration: selectedDuration, intensity: selectedIntensity,
                warmup: exercisePool.warmup, main: mainExercises, cooldown: exercisePool.cooldown,
                totalExercises: mainExercises.length + exercisePool.warmup.length + exercisePool.cooldown.length
            };
        }

        function renderWorkout(workout) {
            const container = document.getElementById('workout-container');
            const focusLabels = { full: 'Full Body', upper: 'Upper Body', lower: 'Lower Body', core: 'Core', cardio: 'Cardio HIIT' };
            let exerciseNumber = 1;

            container.innerHTML = `
                <div class="workout-detail">
                    <div class="workout-header">
                        <div class="workout-type">${workout.intensity} intensity</div>
                        <div class="workout-title">${focusLabels[workout.type]} Workout</div>
                        <div class="workout-meta"><span>‚è±Ô∏è ${workout.duration} min</span><span>üí™ ${workout.main.length} exercises</span></div>
                    </div>
                    <div class="workout-body">
                        <div class="section-label">üî• Warm-Up (3 min)</div>
                        ${workout.warmup.map(ex => `
                            <div class="exercise-card">
                                <div class="exercise-header">
                                    <div class="exercise-number">${exerciseNumber++}</div>
                                    <div class="exercise-info">
                                        <div class="exercise-name">${ex.name}</div>
                                        <div class="exercise-meta">${ex.duration}</div>
                                    </div>
                                </div>
                                <div class="exercise-detail">üí° ${ex.tip}</div>
                            </div>
                        `).join('')}
                        <div class="section-label">üí™ Main Workout</div>
                        ${workout.main.map(ex => `
                            <div class="exercise-card">
                                <div class="exercise-header">
                                    <div class="exercise-number">${exerciseNumber++}</div>
                                    <div class="exercise-info">
                                        <div class="exercise-name">${ex.name}</div>
                                        <div class="exercise-meta">${ex.sets} sets √ó ${ex.reps} reps ‚Ä¢ ${ex.rest}s rest</div>
                                    </div>
                                </div>
                                <div class="exercise-detail">üí° ${ex.tip}</div>
                            </div>
                        `).join('')}
                        <div class="section-label">üßò Cool-Down (3 min)</div>
                        ${workout.cooldown.map(ex => `
                            <div class="exercise-card">
                                <div class="exercise-header">
                                    <div class="exercise-number">${exerciseNumber++}</div>
                                    <div class="exercise-info">
                                        <div class="exercise-name">${ex.name}</div>
                                        <div class="exercise-meta">${ex.duration}</div>
                                    </div>
                                </div>
                                <div class="exercise-detail">üí° ${ex.tip}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="workout-actions">
                        <button class="action-btn secondary" onclick="generateWorkout()">üîÑ New</button>
                        <button class="action-btn primary" onclick="startWorkout()">‚ñ∂Ô∏è Start Workout</button>
                    </div>
                </div>
            `;
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function startWorkout() {
            if (!currentWorkout) return;
            currentExerciseIndex = 0;
            const allExercises = [
                ...currentWorkout.warmup.map(e => ({ ...e, phase: 'warmup' })),
                ...currentWorkout.main.map(e => ({ ...e, phase: 'main' })),
                ...currentWorkout.cooldown.map(e => ({ ...e, phase: 'cooldown' }))
            ];
            currentWorkout.allExercises = allExercises;
            document.getElementById('workout-modal').classList.add('show');
            showExercise(0);
        }

        function showExercise(index) {
            const exercises = currentWorkout.allExercises;
            if (index >= exercises.length) { completeWorkout(); return; }

            const ex = exercises[index];
            const progress = ((index + 1) / exercises.length) * 100;
            const phaseLabel = ex.phase === 'warmup' ? 'üî• Warm-Up' : ex.phase === 'main' ? 'üí™ Main' : 'üßò Cool-Down';

            document.getElementById('modal-body').innerHTML = `
                <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div>
                <div class="active-exercise">
                    <div class="active-exercise-number">${phaseLabel} ‚Ä¢ Exercise ${index + 1} of ${exercises.length}</div>
                    <div class="active-exercise-name">${ex.name}</div>
                    <div class="active-exercise-detail">${ex.sets ? `${ex.sets} sets √ó ${ex.reps}` : ex.duration}</div>
                    <div class="timer-display" id="timer">00:00</div>
                    <div class="active-exercise-tip">üí° ${ex.tip}</div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn secondary" onclick="cancelWorkout()">‚úï End</button>
                    <button class="modal-btn primary" onclick="nextExercise()">‚úì Done</button>
                </div>
            `;
            startTimer();
        }

        function showRest(restTime, nextExercise) {
            clearInterval(timerInterval);
            let remaining = restTime;

            document.getElementById('modal-body').innerHTML = `
                <div class="rest-overlay">
                    <div class="rest-text">Rest Time</div>
                    <div class="timer-display" id="rest-timer">${remaining}</div>
                    <div class="next-up">Next: ${nextExercise.name}</div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn skip" onclick="skipRest()">Skip Rest</button>
                </div>
            `;

            timerInterval = setInterval(() => {
                remaining--;
                document.getElementById('rest-timer').textContent = remaining;
                if (remaining <= 0) { clearInterval(timerInterval); showExercise(currentExerciseIndex); }
            }, 1000);
        }

        function nextExercise() {
            clearInterval(timerInterval);
            currentExerciseIndex++;
            const exercises = currentWorkout.allExercises;
            const prevEx = exercises[currentExerciseIndex - 1];
            const nextEx = exercises[currentExerciseIndex];

            if (prevEx && prevEx.rest && nextEx && nextEx.phase === 'main') {
                showRest(prevEx.rest, nextEx);
            } else {
                showExercise(currentExerciseIndex);
            }
        }

        function skipRest() { clearInterval(timerInterval); showExercise(currentExerciseIndex); }

        function startTimer() {
            exerciseTime = 0;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                exerciseTime++;
                const mins = Math.floor(exerciseTime / 60);
                const secs = exerciseTime % 60;
                const timerEl = document.getElementById('timer');
                if (timerEl) timerEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);
        }

        function cancelWorkout() { clearInterval(timerInterval); document.getElementById('workout-modal').classList.remove('show'); }

        function completeWorkout() {
            clearInterval(timerInterval);
            const totalMins = currentWorkout.duration;

            const history = Memory.get('fitness', 'history') || [];
            history.unshift({
                date: new Date().toISOString(), type: currentWorkout.type,
                intensity: currentWorkout.intensity, duration: totalMins,
                exercises: currentWorkout.main.map(e => e.name)
            });
            Memory.set('fitness', 'history', history.slice(0, 50));

            document.getElementById('modal-body').innerHTML = `
                <div class="active-exercise" style="padding: 60px 30px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
                    <div class="active-exercise-name">Workout Complete!</div>
                    <div class="active-exercise-detail" style="color: #8AE98D;">${currentWorkout.main.length} exercises ‚Ä¢ ~${totalMins} min</div>
                    <div class="active-exercise-tip" style="margin-top: 30px;">Great job! You're one workout stronger. üí™</div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" onclick="closeCompletion()">Done</button>
                </div>
            `;
        }

        function closeCompletion() {
            document.getElementById('workout-modal').classList.remove('show');
            renderHistory();
            switchTab('history');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.remove('active');
        }

        function renderHistory() {
            const history = Memory.get('fitness', 'history') || [];
            const container = document.getElementById('history-list');

            if (history.length === 0) {
                container.innerHTML = `<div class="empty-state"><div class="empty-icon">üìä</div><p>No workouts yet.<br>Generate and complete a workout to see it here!</p></div>`;
                return;
            }

            const focusLabels = { full: 'Full Body', upper: 'Upper Body', lower: 'Lower Body', core: 'Core', cardio: 'Cardio' };
            container.innerHTML = history.map(h => {
                const date = new Date(h.date);
                const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                return `
                    <div class="history-item">
                        <div class="history-date">${dateStr} at ${timeStr}</div>
                        <div class="history-title">${focusLabels[h.type] || h.type} ‚Ä¢ ${h.intensity}</div>
                        <div class="history-exercises">${h.exercises.join(' ‚Üí ')}</div>
                        <div class="history-stats">
                            <span class="history-stat">‚è±Ô∏è ${h.duration} min</span>
                            <span class="history-stat">üí™ ${h.exercises.length} exercises</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        init();
    </script>
</body>
</html>
