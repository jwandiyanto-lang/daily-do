<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness - Daily Do</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #0E121A;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            padding-bottom: 100px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #888;
            margin-bottom: 30px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            color: #888;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .tab-btn.active {
            background: #F7C846;
            color: #0E121A;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Today's Mix */
        .today-mix {
            background: linear-gradient(135deg, #1a1f2e 0%, #0E121A 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .mix-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .mix-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .shuffle-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            color: #fff;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mix-workout {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mix-workout:last-child {
            margin-bottom: 0;
        }

        .mix-workout-info {
            flex: 1;
        }

        .mix-workout-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .mix-workout-meta {
            font-size: 0.8rem;
            color: #888;
        }

        .mix-workout-time {
            background: rgba(247, 200, 70, 0.2);
            color: #F7C846;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .start-btn {
            width: 100%;
            padding: 16px;
            background: #F7C846;
            border: none;
            border-radius: 12px;
            color: #0E121A;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            font-family: inherit;
        }

        /* Workout Library */
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: #888;
        }

        .workout-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .workout-card {
            background: rgba(255,255,255,0.05);
            border-radius: 14px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .workout-card:hover {
            background: rgba(255,255,255,0.08);
        }

        .workout-card.selected {
            border-color: #F7C846;
            background: rgba(247, 200, 70, 0.1);
        }

        .workout-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .workout-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .workout-desc {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
        }

        .workout-time {
            font-size: 0.75rem;
            color: #F7C846;
            font-weight: 500;
        }

        /* Build Your Mix */
        .build-mix {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .build-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .build-title {
            font-weight: 600;
        }

        .build-total {
            color: #F7C846;
            font-size: 0.9rem;
        }

        .selected-list {
            margin-bottom: 12px;
        }

        .selected-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .selected-item:last-child {
            border: none;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* History */
        .history-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .history-date {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
        }

        .history-workouts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history-tag {
            background: rgba(138, 233, 141, 0.2);
            color: #8AE98D;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .history-total {
            margin-top: 8px;
            font-size: 0.85rem;
            color: #888;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        /* Active Workout Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1f2e;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-meta {
            color: #888;
            margin-bottom: 20px;
        }

        .modal-timer {
            font-size: 3rem;
            font-weight: 700;
            color: #F7C846;
            margin-bottom: 30px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
        }

        .modal-btn.primary {
            background: #8AE98D;
            color: #0E121A;
        }

        .modal-btn.secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">
        <span>‚Üê</span> Back to Daily Do
    </a>

    <h1>Fitness</h1>
    <p class="subtitle">Quick 20-30 min workouts you can mix</p>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('workout')">Workout</button>
        <button class="tab-btn" onclick="switchTab('history')">History</button>
    </div>

    <!-- Workout Tab -->
    <div id="workout-tab" class="tab-content active">
        <!-- Today's Mix -->
        <div class="today-mix" id="today-mix">
            <div class="mix-header">
                <span class="mix-title">Today's Mix</span>
                <button class="shuffle-btn" onclick="shuffleMix()">
                    üîÄ Shuffle
                </button>
            </div>
            <div id="mix-workouts"></div>
            <button class="start-btn" onclick="startWorkout()">Start Workout</button>
        </div>

        <!-- Workout Library -->
        <div class="section-title">Or build your own mix</div>
        <div class="workout-grid" id="workout-grid"></div>

        <!-- Build Your Mix -->
        <div class="build-mix" id="build-mix" style="display: none;">
            <div class="build-header">
                <span class="build-title">Your Mix</span>
                <span class="build-total" id="build-total">0 min</span>
            </div>
            <div class="selected-list" id="selected-list"></div>
            <button class="start-btn" onclick="startCustomWorkout()">Start This Mix</button>
        </div>
    </div>

    <!-- History Tab -->
    <div id="history-tab" class="tab-content">
        <div id="history-list"></div>
    </div>

    <!-- Active Workout Modal -->
    <div id="workout-modal" class="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">üí™</div>
            <div class="modal-title" id="modal-title">Workout</div>
            <div class="modal-meta" id="modal-meta">25 min total</div>
            <div class="modal-timer" id="modal-timer">00:00</div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="cancelWorkout()">Cancel</button>
                <button class="modal-btn primary" onclick="completeWorkout()">Done!</button>
            </div>
        </div>
    </div>

    <script src="../scripts/memory.js"></script>
    <script>
        // Workout library - simple 20-30 min sessions
        const workouts = [
            { id: 'hiit', name: 'HIIT', icon: 'üî•', desc: 'High intensity intervals', time: 20 },
            { id: 'strength', name: 'Strength', icon: 'üí™', desc: 'Bodyweight or weights', time: 25 },
            { id: 'cardio', name: 'Cardio', icon: 'üèÉ', desc: 'Running, cycling, etc', time: 30 },
            { id: 'core', name: 'Core', icon: 'üéØ', desc: 'Abs and stability', time: 15 },
            { id: 'stretch', name: 'Stretch', icon: 'üßò', desc: 'Flexibility & recovery', time: 15 },
            { id: 'upper', name: 'Upper Body', icon: 'üèãÔ∏è', desc: 'Arms, chest, back', time: 25 },
            { id: 'lower', name: 'Lower Body', icon: 'ü¶µ', desc: 'Legs and glutes', time: 25 },
            { id: 'tabata', name: 'Tabata', icon: '‚ö°', desc: '20s on, 10s off', time: 20 },
        ];

        let selectedWorkouts = [];
        let todaysMix = [];
        let activeWorkout = null;
        let timerInterval = null;
        let startTime = null;

        // Initialize
        function init() {
            if (typeof Memory !== 'undefined') {
                Memory.setLastVisited('fitness');
            }
            renderWorkoutGrid();
            generateTodaysMix();
            renderHistory();
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }

        // Generate random mix for today (2-3 workouts, ~30-45 min)
        function generateTodaysMix() {
            const shuffled = [...workouts].sort(() => Math.random() - 0.5);
            todaysMix = shuffled.slice(0, 2);
            renderTodaysMix();
        }

        function shuffleMix() {
            generateTodaysMix();
        }

        function renderTodaysMix() {
            const container = document.getElementById('mix-workouts');
            const totalTime = todaysMix.reduce((sum, w) => sum + w.time, 0);

            container.innerHTML = todaysMix.map(w => `
                <div class="mix-workout">
                    <div class="mix-workout-info">
                        <div class="mix-workout-name">${w.icon} ${w.name}</div>
                        <div class="mix-workout-meta">${w.desc}</div>
                    </div>
                    <span class="mix-workout-time">${w.time} min</span>
                </div>
            `).join('') + `
                <div style="text-align: center; color: #888; font-size: 0.85rem; margin-top: 12px;">
                    Total: ${totalTime} min
                </div>
            `;
        }

        // Render workout grid
        function renderWorkoutGrid() {
            const grid = document.getElementById('workout-grid');
            grid.innerHTML = workouts.map(w => `
                <div class="workout-card ${selectedWorkouts.includes(w.id) ? 'selected' : ''}"
                     onclick="toggleWorkout('${w.id}')">
                    <div class="workout-icon">${w.icon}</div>
                    <div class="workout-name">${w.name}</div>
                    <div class="workout-desc">${w.desc}</div>
                    <div class="workout-time">${w.time} min</div>
                </div>
            `).join('');
        }

        // Toggle workout selection
        function toggleWorkout(id) {
            const idx = selectedWorkouts.indexOf(id);
            if (idx === -1) {
                selectedWorkouts.push(id);
            } else {
                selectedWorkouts.splice(idx, 1);
            }
            renderWorkoutGrid();
            renderBuildMix();
        }

        // Render build mix section
        function renderBuildMix() {
            const container = document.getElementById('build-mix');
            const list = document.getElementById('selected-list');
            const total = document.getElementById('build-total');

            if (selectedWorkouts.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            const selected = selectedWorkouts.map(id => workouts.find(w => w.id === id));
            const totalTime = selected.reduce((sum, w) => sum + w.time, 0);

            total.textContent = totalTime + ' min';
            list.innerHTML = selected.map(w => `
                <div class="selected-item">
                    <span>${w.icon} ${w.name} - ${w.time} min</span>
                    <button class="remove-btn" onclick="toggleWorkout('${w.id}')">√ó</button>
                </div>
            `).join('');
        }

        // Start workout
        function startWorkout() {
            activeWorkout = todaysMix;
            showWorkoutModal();
        }

        function startCustomWorkout() {
            if (selectedWorkouts.length === 0) return;
            activeWorkout = selectedWorkouts.map(id => workouts.find(w => w.id === id));
            showWorkoutModal();
        }

        function showWorkoutModal() {
            const modal = document.getElementById('workout-modal');
            const totalTime = activeWorkout.reduce((sum, w) => sum + w.time, 0);
            const names = activeWorkout.map(w => w.name).join(' + ');
            const icons = activeWorkout.map(w => w.icon).join(' ');

            document.getElementById('modal-icon').textContent = icons;
            document.getElementById('modal-title').textContent = names;
            document.getElementById('modal-meta').textContent = totalTime + ' min workout';

            modal.classList.add('show');
            startTimer();
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const mins = Math.floor(elapsed / 60);
            const secs = elapsed % 60;
            document.getElementById('modal-timer').textContent =
                String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
        }

        function cancelWorkout() {
            clearInterval(timerInterval);
            document.getElementById('workout-modal').classList.remove('show');
            activeWorkout = null;
        }

        function completeWorkout() {
            clearInterval(timerInterval);
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const mins = Math.ceil(elapsed / 60);

            // Save to history
            const history = Memory.get('fitness', 'history') || [];
            history.unshift({
                date: new Date().toISOString(),
                workouts: activeWorkout.map(w => w.name),
                duration: mins,
                icons: activeWorkout.map(w => w.icon)
            });
            Memory.set('fitness', 'history', history.slice(0, 30)); // Keep last 30

            document.getElementById('workout-modal').classList.remove('show');
            activeWorkout = null;

            // Clear custom selection
            selectedWorkouts = [];
            renderWorkoutGrid();
            renderBuildMix();

            // Show history
            switchTab('history');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.remove('active');
            renderHistory();
        }

        // Render history
        function renderHistory() {
            const history = Memory.get('fitness', 'history') || [];
            const container = document.getElementById('history-list');

            if (history.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <p>No workouts yet.<br>Complete a workout to see it here!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = history.map(h => {
                const date = new Date(h.date);
                const dateStr = date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                const timeStr = date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit'
                });

                return `
                    <div class="history-item">
                        <div class="history-date">${dateStr} at ${timeStr}</div>
                        <div class="history-workouts">
                            ${h.workouts.map((w, i) => `
                                <span class="history-tag">${h.icons?.[i] || 'üí™'} ${w}</span>
                            `).join('')}
                        </div>
                        <div class="history-total">${h.duration} min completed</div>
                    </div>
                `;
            }).join('');
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
